201~200~\documentclass{article}
\usepackage{amsmath}
\usepackage{graphicx} % Required for inserting images
\usepackage{listings}
\usepackage{ragged2e}
\usepackage{verbatim}
\usepackage{color}
\usepackage{fancyhdr} % For custom headers and footers
\usepackage{amsfonts}
% Define colors for code
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
	    backgroundcolor=\color{backcolour},   
	        commentstyle=\color{codegreen},
	            keywordstyle=\color{magenta},
	                numberstyle=\tiny\color{codegray},
	                    stringstyle=\color{codepurple},
	                        basicstyle=\ttfamily\footnotesize,
	                            breakatwhitespace=false,         
	                                breaklines=true,                 
	                                    captionpos=b,                    
	                                        keepspaces=true,                 
	                                            numbers=left,                    
	                                                numbersep=5pt,                  
	                                                    showspaces=false,                
	                                                        showstringspaces=false,
	                                                            showtabs=false,                  
	                                                                tabsize=2
	                                                                }

	                                                                \lstset{style=mystyle}

	                                                                % Setup the header and footer
	                                                                \pagestyle{fancy}
	                                                                \fancyhf{} % Clear all header and footer fields
	                                                                \fancyfoot[L]{CAA 24-25} % Left side of the footer
	                                                                \fancyfoot[C]{November 2024 - Nathan Rayburn} % Center of the footer
	                                                                \fancyfoot[R]{\thepage} % Right side of the footer, with the page number
	                                                                \renewcommand{\footrulewidth}{0.4pt} % Thickness of the footer line

	                                                                \title{CAA 24-25: Lab \#2}
	                                                                \author{Nathan Rayburn}
	                                                                \date{November 11, 2024}

	                                                                \begin{document}

	                                                                \maketitle

	                                                                \begin{abstract}
	                                                                This report analyzes potential vulnerabilities in ECDSA and demonstrates how lattice reduction techniques, specifically using the Lenstra–Lenstra–Lovász basis reduction algorithm, can compromise security when certain nonces are known. The lab covers deterministic-ECDSA weaknesses, focusing on nonce exposure and lattice attacks.
	                                                                \end{abstract}

	                                                                \section{Introduction}
	                                                                In this lab, we examine common pitfalls in ECDSA implementations, analyzing both deterministic and random algorithms. The lattice-reduction attack applied here allows private key recovery if a portion of the nonce is known. An additional resource used: https://eprint.iacr.org/2019/023.pdf.

	                                                                \section{Lattice Attack on the Hidden Number Problem}
	                                                                In this section, we describe how one can solve the \textit{hidden number problem} using lattice attacks. The hidden number problem is defined as follows:

	                                                                Let $\alpha \in \mathbb{Z}_p$ be a secret. Let $B$ be a known bound with $B$ much smaller than $p$. Given pairs $(t_i, a_i)$ such that $t_i \alpha - a_i \mod p = b_i$, with $b_i < B$, find the secret $\alpha$.

	                                                                To solve this problem, we employ lattice reduction, specifically using the LLL algorithm. The steps are as follows:

	                                                                \begin{itemize}
	                                                                    \item Create the following matrix $M$ over the rational numbers $\mathbb{Q}$:
	                                                                        \[
	                                                                        	    M = \begin{bmatrix}
	                                                                        	        p & 0 & 0 & \dots & 0 \\
	                                                                        	            0 & p & 0 & \dots & 0 \\
	                                                                        	                \vdots & \vdots & \ddots & \vdots & \vdots \\
	                                                                        	                    t_1 & t_2 & \dots & t_m & \frac{B}{p} & 0 \\
	                                                                        	                        a_1 & a_2 & \dots & a_m & 0 & B
	                                                                        	                            \end{bmatrix}
	                                                                        	                                \]
	                                                                        	                                    where the empty elements are zero. The dimensions of the matrix are $(m+2) \times (m+2)$.

	                                                                        	                                        \item To construct this matrix in Sage, use the command \texttt{MatrixSpace(QQ, rows, cols)} and then obtain an identity matrix within this space with the method \texttt{identity\_matrix()}. Assign this identity matrix to $A$. Use \texttt{A[i,j] = new\_val} to modify the $(i, j)$-th element in the matrix.

	                                                                        	                                            \item Run the LLL algorithm using the method \texttt{LLL()} on this matrix $M$ to obtain an equivalent basis with shorter vectors.

	                                                                        	                                                \item If successful, the vector $(b_1, b_2, \dots, b_m, B\alpha/p, B)$ is a short vector in this matrix, allowing you to recover $\alpha$.
	                                                                        	                                                \end{itemize}


	                                                                        	                                                \section{Questions}
	                                                                        	                                                \subsection{1.1 Explanation of Vector Linear Combination}

	                                                                        	                                                Discuss why the vector \((b_1, b_2, \ldots, b_m, B\alpha/p, B)\) is a linear combination of the matrix rows.

	                                                                        	                                                The primary objective of lattice reduction techniques, such as the LLL algorithm, is to find shorter vectors within a lattice that retains the same structure but with a reduced basis. In this case, the vector \((b_1, b_2, \ldots, b_m, B\alpha/p, B)\) is of particular interest because it represents a "short vector" within the lattice spanned by the rows of the matrix \(M\).

	                                                                        	                                                \paragraph{Explanation}
	                                                                        	                                                \begin{enumerate}
	                                                                        	                                                    \item \textbf{Matrix Construction and Lattice Basis}: \\
	                                                                        	                                                        The matrix \(M\) is constructed in such a way that each row of \(M\) represents a basis vector in a lattice defined over the rational numbers \(\mathbb{Q}\). Each of these basis vectors is designed to encode a relationship between the known values \(t_i\), \(a_i\), and the unknown value \(\alpha\). This setup is intended to capture the structure of the hidden number problem in a lattice form.

	                                                                        	                                                            \item \textbf{Target Vector as a Linear Combination}: \\
	                                                                        	                                                                Since the target vector \((b_1, b_2, \ldots, b_m, B\alpha/p, B)\) is a short vector in the lattice spanned by the rows of \(M\), it must be expressible as a linear combination of the matrix's row vectors. In other words, there exists a set of coefficients \((c_1, c_2, \ldots, c_{m+2})\) such that:
	                                                                        	                                                                    \[
	                                                                        	                                                                    	    (b_1, b_2, \ldots, b_m, B\alpha/p, B) = c_1 \cdot \text{row}_1 + c_2 \cdot \text{row}_2 + \ldots + c_{m+2} \cdot \text{row}_{m+2}
	                                                                        	                                                                    	        \]
	                                                                        	                                                                    	            where \(\text{row}_i\) denotes the \(i\)-th row of matrix \(M\).

	                                                                        	                                                                    	                \item \textbf{Why This Vector is a "Short Vector"}: \\
	                                                                        	                                                                    	                    The LLL algorithm aims to find short. For a set of vectors, the goal is to find a shorter vector keeping the same Lattice by constructing a new set of basis using the orthogonal projection. 

	                                                                        	                                                                    	                            For an example :
	                                                                        	                                                                    	                                \[
	                                                                        	                                                                    	                                	        \Vec{b_1} = (0,4)
	                                                                        	                                                                    	                                	            \]

	                                                                        	                                                                    	                                	                    \[
	                                                                        	                                                                    	                                	                    	        \Vec{b_2} = (1,3)
	                                                                        	                                                                    	                                	                    	            \]


	                                                                        	                                                                    	                                	                    	                Our Lattice would be the linear combinations of all integers in $\mathbb{Z}$ for our defined set of vectors of some basis $B$:


	                                                                        	                                                                    	                                	                    	                    \[
	                                                                        	                                                                    	                                	                    	                    	        L = \sum_{i=1}^{m} \mathbb{Z} \cdot b_i = \left( \sum_{i=1}^{m}z_i \cdot b_i, \texttt{where } z_i \in\mathbb{Z}, b_i \in B, m \in \mathbb{N}  \right)
	                                                                        	                                                                    	                                	                    	                    	            \]


	                                                                        	                                                                    	                                	                    	                    	                    For our set of our two vectors :
	                                                                        	                                                                    	                                	                    	                    	                        \[
	                                                                        	                                                                    	                                	                    	                    	                        	        L = \sum_{i=1}^{2}z_i \cdot b_i
	                                                                        	                                                                    	                                	                    	                    	                        	            \]

	                                                                        	                                                                    	                                	                    	                    	                        	                Our "Short vector" being orthogonal and keeping the same $L$ would be :

	                                                                        	                                                                    	                                	                    	                    	                        	                        \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	        \Vec{b_1*} = (-1,1)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	            \]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	        \Vec{b_2*} = (2,2)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	            \]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                \begin{figure}[h]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                        \centering
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                \includegraphics[width=1\linewidth]{reduction.png}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                        \caption{A lattice with two different basis. The right basis is reduced and orthogonal.}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                \label{fig:figure-1}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                    \end{figure}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                            In a 2D reduced basis ( $b_1$, $b_2$ ) is said to be reduced if it satisfies the following condition: 

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	    ||b_1|| <= ||b_2||
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	        \]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	            $u$ defined as our orthogonal projection coefficient.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	    u = \frac{b_1 \cdot b_2 }{||b_1||²} <= \frac{1}{2}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	        \]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	            \begin{figure}[h]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                    \centering
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                            \includegraphics[width=0.5\linewidth]{ortho.png}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                    \caption{Orthogonal projection}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                            \label{fig:figure-2}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                \end{figure}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                        In our contexte the vector \((b_1, b_2, \ldots, b_m, B\alpha/p, B)\) is chosen as it contains the small values \(b_i < B\) along with terms proportional to \(B\alpha/p\) and \(B\). These values are small relative to the other possible combinations in the lattice.

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                            \item \textbf{Recovering \(\alpha\)}: \\
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                If the LLL algorithm successfully identifies \((b_1, b_2, \ldots, b_m, B\alpha/p, B)\) as a short vector in the reduced basis, we can then isolate the term \(B\alpha/p\) and recover the secret \(\alpha\). Specifically, since \(B\alpha/p\) is known to be an integer, this value can be extracted from the short vector, enabling the recovery of \(\alpha\) by rearranging terms. 
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    To recover the secret value \(\alpha\), we use the following formula:

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	\alpha = \mathbb{Z} \left( \frac{-v[-2] \cdot n}{B} \mod n \right)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	where:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	\begin{itemize}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	    \item \(\alpha\) is the unknown value we are trying to recover.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	        \item \(v[-2]\) represents the second-to-last element in the vector \(v\), obtained from the LLL-reduced basis.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	            \item \(n\) is the modulus related to the hidden number problem.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                \item \(B\) is a known bound that defines the problem constraints.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \item \(\mathbb{Z}(\cdot)\) indicates the integer part of the expression within.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \end{itemize}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \end{enumerate}


	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \subsection{1.2 Vector Comparison to \( p \)}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    Explain why the vector \( (b_1, b_2, \ldots, b_m, B\alpha/p, B) \) is relatively small compared to \( p \). ( In our case $n$ )

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    In both challenges, our boundary \( B \) is chosen to be significantly smaller than \( p \). The reason for this is that the lattice reduction algorithm, such as LLL, is more effective when applied to a lattice defined by shorter vectors with smaller magnitudes. By constructing the vector \( (b_1, b_2, \ldots, b_m, B\alpha/p, B) \) with components scaled by \( B \), we ensure that it is "short" relative to \( p \). The \( b_i \) term represents a small error term. Specifically: \( b_1, b_2, \dots, b_m \) are the error terms in the hidden number equation, where each \( b_i = t_i \alpha - a_i \mod p \) and \( |b_i| < B \). These error terms are small values bounded by \( B \), representing the discrepancies between \( t_i \alpha \) and \( a_i \) in each instance of the modular equation.



	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \subsection{1.3 Summarize what the LLL algorithm does and its application in this lab.}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    Thus, the vector \((b_1, b_2, \ldots, b_m, B\alpha/p, B)\) is a linear combination of the matrix rows because it lies within the lattice generated by these rows. By using lattice reduction to find this short vector, we exploit the properties of the lattice to uncover the hidden number \(\alpha\), achieving our goal in solving the hidden number problem.

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \section{Challenge 1: Nonce Bits Known}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \begin{abstract}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    The first challenge was slightly guided to understand the fundamentals how we can detect and apply an Lenstra–Lenstra–Lovász basis reduction algorithm. The first challenge we can observe that our element $k$ which is used as a random nonce for ECDSA signatures, is generated within 352 bits. This is relatively smaller than $p$ ( 384 bits) which can lead us to being able to apply the LLL algorithm since part of the nonce is know.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \end{abstract}


	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \subsection{Conversion to Hidden Number Problem}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    In this section, we convert the problem of recovering the ECDSA private key with known nonce bits into a hidden number problem. The hidden number problem is defined as follows:

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    Let $\alpha \in \mathbb{Z}_p$ be a secret. Let $B$ be a known bound with $B \ll p$. Given pairs $(t_i, a_i)$ such that:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    	t_i \alpha - a_i \mod p = b_i, \quad \text{with } b_i < B,
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    	\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    	find the secret $\alpha$. (In our context $n = p$)

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    	In the context of ECDSA, the goal is to recover the private key $\alpha$ using multiple signatures $(r_i, s_i)$ and corresponding messages $m_i$. For each signature, the nonce $k_i$ satisfies:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    	\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    		s_i = \frac{h(m_i) + \alpha \cdot r_i}{k_i} \mod n,
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    		\]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    		where $h(m_i)$ is the hash of the message, and $n$ is the order of the curve. Rearranging this equation to isolate $k_i$, we obtain:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    		\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    			k_i = \frac{h(m_i) + \alpha \cdot r_i}{s_i} \mod n.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    			\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    			We can rewrite $k_i$ as:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    			\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    				k_i = \frac{h(m_i)}{s_i} + \frac{\alpha \cdot r_i}{s_i} \mod n.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    				\]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    				Let:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    				\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    					t_i \cdot \alpha = \frac{\alpha \cdot r_i}{s_i} \mod n \quad \text{and} \quad -a_i = \frac{h(m_i)}{s_i} \mod n.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    					\]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    					Isolating : 
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    					\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    						t_i = \frac{r_i}{s_i} \mod n \quad \text{and} \quad a_i = -\frac{h(m_i)}{s_i} \mod n.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    						\]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    						\subsubsection*{Why $k_i = b_i$:}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    						The equivalence $k_i = b_i$ arises because $b_i$ represents the residual error term in the modular equation:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    						\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							b_i = t_i \cdot \alpha - a_i \mod n.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							\]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							This error term is directly related to $k_i$ through the relationship defined by the signature equation. Since the lattice reduction algorithm focuses on finding small values of $b_i$, and $b_i$ captures the modular behavior of $k_i$, we can use them interchangeably within the lattice framework.

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							To summarize:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							\begin{itemize}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							    \item $k_i$ is the nonce in the signature equation.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							        \item $b_i$ is the modular error term in the hidden number problem formulation.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							            \item The equivalence $k_i = b_i$ holds because both describe the same mathematical quantity under modular arithmetic.
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							            \end{itemize}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							            By implementing these equations using lattice reduction, we recover a "short vector", enabling the determination of $\alpha$, the private key.


	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							            \subsection{Key Recovery}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							            Implement and describe the approach used to recover the private key from ECDSA signatures with specific nonce bit settings.

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							            \begin{lstlisting}[language=Python, caption=Python Code for Lattice Attack Setup]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                m1 = messages1
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                    s1 = signatures1

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                        nbCols = len(s1) + 2
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                            nbRows = nbCols
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                Aspace = MatrixSpace(QQ, nbRows, nbCols)

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                        A = copy(Aspace.identity_matrix())

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                            A = A*n
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                B = n // pow(2,32)

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                    A[ - 2,  - 2] = B / n
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                        A[ - 1,  - 1] = B

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                            for i in range(len(m1)):

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                            ai = ((-h(m1[i]))/s1[i][1]) % n
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                    ti = (s1[i][0]/s1[i][1]) % n
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                            A[-1, i] = ai
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                    A[-2, i] = ti

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                            M = A.LLL()

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                for v in M:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                        if v[-1] == B:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                    alpha = ZZ((- v[-2] * n / B)%n)

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                            if (alpha * G == A1):
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                    print("Cracked private key")
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                            print(alpha)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                            \end{lstlisting}


	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                            \section{Challenge 2: Deterministic ECDSA - Weakness Analysis}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                            We observe that \( k \) can be fully determined without any unknown variables, which implies that the intended security of the discrete logarithm problem is no longer leveraged for \( k \cdot G \). Additionally, as shown below, the key (computed with \( \text{hash}(h) \)) and the nonce (fixed as \\x00) are not random in the ChaCha20 context, allowing us to easily derive \( k \).

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                            \begin{lstlisting}[language=Python, caption=Signature function Chall 2]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                            def sign2(G, m, n, a):
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                F = Integers(n)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                    key = hashlib.sha256(m).digest()
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                        nonce = b"\x00"*24
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                            cipher = ChaCha20.new(key=key, nonce = nonce)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                #ciphertext = cipher.encrypt(plaintext)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                    size_n = ceil(RR(log(n,2))/8) #taille en bytes
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                        k = int.from_bytes(cipher.encrypt(b"\x00"*size_n))
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                            (x1,y1) = (k*G).xy()
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                r = F(x1)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    return (r, (F(h(m)) +a * r) /F(k))
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    \end{lstlisting}


	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    Signature formula : 
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    	s_i = \left( \frac{h(m_i) + \alpha \cdot r_i}{k_i} \mod n \right)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    	\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    	Therefore isolating $alpha$ : 
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    	\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		alpha = \frac{s \cdot k - h(m)}{r}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		Let's implement.

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		\begin{lstlisting}[language=Python, caption=Cracking the key for Chall 2]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		def challenge2(p,E,G,n):

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		    ...

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		            nonce = b"\x00"*24
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                i = 0

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                        m = messages2[i]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                            r = signatures2[i][0]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                s = signatures2[i][1]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                    F = Integers(n)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                        key = hashlib.sha256(m).digest()                    # can calculate

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                            cipher = ChaCha20.new(key=key, nonce = nonce)       
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                size_n = ceil(RR(log(n,2))/8) 
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                    k = int.from_bytes(cipher.encrypt(b"\x00"*size_n))  # can calcualte

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                            a = F(s * k - h(m))/F(r)                            # Isolating the key

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                if ( a * G == A2 ):
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                        print("Cracked private key")
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                print(a)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                \end{lstlisting}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                \section{Challenge 3: Further Deterministic ECDSA Analysis}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                We can see that if all messages use the same key \( \alpha \), they will also share the same \( k \) and, consequently, the same \( r \). By examining the signatures, we confirm that each message indeed has the same \( r \), validating the hypothesis that only two messages are needed to recover the private key \( \alpha \).

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                \begin{lstlisting}[language=Python, caption=Signature for Chall 3]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                def sign3(G, m, n, a):
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                    F = Integers(n)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                        key = hashlib.sha256(str(a).encode()).digest()
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                            nonce = hashlib.sha256(str(a).encode()).digest()[:24]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                cipher = ChaCha20.new(key=key, nonce = nonce)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                    #ciphertext = cipher.encrypt(plaintext)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                        size_n = ceil(RR(log(n,2))/8) #taille en bytes
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                            k = int.from_bytes(cipher.encrypt(b"\x00"*size_n))
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                (x1,y1) = (k*G).xy()
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                    r = F(x1)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        return (r, (F(h(m)) +a * r) /F(k))
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        \end{lstlisting}


	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        We define an $s$ and an $s'$ :

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        	s = \frac{h(m_1) + \alpha \cdot r}{k}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        	\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        	\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        		s' = \frac{h(m_2) + \alpha \cdot r}{k}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        		\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        		Isolate $\alpha$ :

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        		\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        			\alpha = \frac{s \cdot k - h(m_1)}{r}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        			\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        			We remove $\alpha$ from our first equation and isolate k:


	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        			\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    \frac{s \cdot k - h(m_1)}{r} = \frac{s' \cdot k - h(m_2)}{r}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    \]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    \[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    	s \cdot k - h(m_1) = s' \cdot k - h(m_2)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    	\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    	\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    		s \cdot k - s' \cdot k = h(m_1) - h(m_2)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    		\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    		\[
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			k = \frac{h(m_1) - h(m_2)}{s-s'}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			\]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			Let's implement.

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			\begin{lstlisting}[language=Python, caption = Cracking private key Chall 3]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			def challenge3(p,E,G,n):

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			        ...

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                m1 = messages3[0]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                    m2 = messages3[1]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                        F = Integers(n)

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                r      = signatures3[0][0]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                    s      = signatures3[0][1]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                        sprime = signatures3[1][1]

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                            k = F((h(m1)-h(m2))/(s-sprime))

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                alpha = F((s*k - h(m1))/r)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                    if alpha * G == A3:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                            print("Cracked private key")
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                    print(alpha)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                    \end{lstlisting}


	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                    \section{Challenge 4: Final Deterministic ECDSA Case}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                    In this signature we can see that our $k$ is created predictably the same for each message using $\alpha$ concatenated with the message thrown into a hash function. 
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                    Hash functions are predictable and that our boundary (256 bits) is significantly smaller than $p$, 384 bits ( like said before in our case $n$ ). Therefore we also know part of the nonce and can apply LLL algorithm like the first challenge.

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                    \begin{lstlisting}[language=Python, caption=Signature Chall 4]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                    def sign4(G, m, n, a):
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                        F = Integers(n)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                            k = int(hashlib.sha256(str(a).encode() + str(m).encode()).hexdigest(),16)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                (x1,y1) = (k*G).xy()
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                    r = F(x1)
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                        return (r, (F(h(m)) +a * r) /F(k))
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                        \end{lstlisting}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                        Let's implement.

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                        \begin{lstlisting}[language=Python, caption=LLL Algorithm to crack private key chall 4]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                            m4 = messages4
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                s4 = signatures4
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                    nbCols = len(signatures4) + 2
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                        nbRows = nbCols
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                            Aspace = MatrixSpace(QQ, nbRows, nbCols)

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                    A = copy(Aspace.identity_matrix())

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                        A = A*n
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                            B = pow(2,256)

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                A[ - 2,  - 2] = B / n
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                    A[ - 1,  - 1] = B

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                        for i in range(len(m4)):

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                        ai = ((-h(m4[i]))/s4[i][1]) % n
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                ti = (s4[i][0]/s4[i][1]) % n
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                        A[-1, i] = ai
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                A[-2, i] = ti

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                        M = A.LLL()

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                            for v in M:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                                    if v[-1] == B:
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                                                alpha = ZZ((- v[-2] * n / B)%n)

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                                                        if (alpha * G == A4):
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                                                                print("Cracked private key")
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                                                                        print(alpha)    
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                                                                        \end{lstlisting}

	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                                                                        \end{document}
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    			                                                                                                                                                                                                                                        
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    		]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    	]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        				    ]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        			]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        		]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        	]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    		                                                                                                                        ]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    	]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    							                                                                                                                                                                                                    ]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    						]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    					]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    				]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    			]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    		]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    	]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    	                    ]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                	                                                                    ]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                	                ]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    	                                                                ]
	                                                                        	                                                                    	                                	                    	                    	                        	                        	                    ]
	                                                                        	                                                                    	                                	                    	                    	                        	                        ]
	                                                                        	                                                                    	                                	                    	                    	                        ]
	                                                                        	                                                                    	                                	                    	                    ]
	                                                                        	                                                                    	                                	                    ]
	                                                                        	                                                                    	                                ]
	                                                                        	                                                                    ]
	                                                                        ]
}
